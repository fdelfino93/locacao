<!DOCTYPE html>
<html>
<head>
    <title>Teste Simples - Formas de Cobran√ßa</title>
</head>
<body>
    <h1>Teste: Formas de Cobran√ßa - ID 5</h1>
    
    <button onclick="testarFormasCobranca()">Testar Formas de Cobran√ßa</button>
    
    <h2>Logs:</h2>
    <div id="logs" style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace;"></div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }

        async function testarFormasCobranca() {
            log('üöÄ Testando formas de cobran√ßa...');
            
            // Dados m√≠nimos para n√£o dar erro de convers√£o
            const dadosParaEnvio = {
                nome: "Empresa PJ Teste - Sem Campos Problematicos",
                formas_envio_cobranca: [
                    {
                        tipo: "email",
                        contato: "teste-simples@example.com",
                        observacoes: "Email teste simples",
                        principal: true,
                        ordem: 0
                    },
                    {
                        tipo: "whatsapp", 
                        contato: "41999888777",
                        observacoes: "WhatsApp teste simples",
                        principal: false,
                        ordem: 1
                    }
                ]
            };

            log('üìù Dados: ' + JSON.stringify(dadosParaEnvio, null, 2));

            try {
                const response = await fetch('http://localhost:8000/api/locatarios/5', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dadosParaEnvio)
                });

                const result = await response.json();
                log('üì° Status: ' + response.status);
                log('üìÑ Response: ' + JSON.stringify(result, null, 2));

                if (response.ok) {
                    log('‚úÖ SUCESSO! Verificando se formas de cobran√ßa foram salvas...');
                    
                    // Verificar se foi salvo
                    const getResponse = await fetch('http://localhost:8000/api/locatarios/5');
                    const getData = await getResponse.json();
                    const formas = getData.data.formas_envio_cobranca || [];
                    
                    log('üìã Formas de cobran√ßa retornadas: ' + formas.length);
                    if (formas.length > 0) {
                        formas.forEach((forma, i) => {
                            log(`${i+1}. ${forma.tipo} - ${forma.contato} (Principal: ${forma.principal})`);
                        });
                        log('üéâ FORMAS DE COBRAN√áA FUNCIONANDO!');
                    } else {
                        log('‚ùå PROBLEMA: Nenhuma forma de cobran√ßa retornada');
                    }
                } else {
                    log('‚ùå ERRO na resposta');
                }

            } catch (error) {
                log('üí• ERRO: ' + error.message);
            }
        }
    </script>
</body>
</html>